
&НаКлиенте
Процедура ПереченьМатериаловКоличествоПриИзменении(Элемент)
	СтрокаТабличнойЧасти = Элементы.ПереченьМатериалов.ТекущиеДанные;
	РаботаСДокументами.РасчитатьСумму(СтрокаТабличнойЧасти);
КонецПроцедуры

&НаКлиенте
Процедура ПереченьМатериаловЦенаПриИзменении(Элемент)
	СтрокаТабличнойЧасти = Элементы.ПереченьМатериалов.ТекущиеДанные;
	РаботаСДокументами.РасчитатьСумму(СтрокаТабличнойЧасти);
КонецПроцедуры

&НаКлиенте
Процедура ПереченьМатериаловМатериалПриИзменении(Элемент)
	СтрокаТабличнойЧасти=Элементы.ПереченьМатериалов.ТекущиеДанные;
	СтрокаТабличнойЧасти.Цена=РаботаСоСправочниками.РозничнаяЦена(Объект.Дата, СтрокаТабличнойЧасти.Материал);
	РаботаСДокументами.РасчитатьСумму(СтрокаТабличнойЧасти);
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьИнтерфейсСканирования(Команда)
	// Вставить содержимое обработчика.
	#Если МобильноеПриложениеКлиент  Тогда
		Элементы.ОткрытьИнтерфейсСканирования.Видимость=1;
		ОбработчикСканирования = Новый ОписаниеОповещения("ОбработкаСканирования", ЭтаФорма);
		ОбработчикЗакрытия = Новый ОписаниеОповещения("ОбработкаЗакрытияИнтерфейса", ЭтаФорма);
		СредстваМультимедиа.ПоказатьСканированиеШтрихКодов("Наведите камеру на штрихкод", ОбработчикСканирования, ОбработчикЗакрытия, ТипШтрихКода.Двухмерный);
	#КонецЕсли
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаСканирования(Штрихкод, Результат, Сообщение, ДополнительныеПараметры) Экспорт
	Ошибка = 0;
	#Если МобильноеПриложениеКлиент  Тогда
		Если Результат Тогда
			ЗакрытьИнтерфейс=1;
		Иначе
			Текст = "Ошибка: " + Сообщение;
			Ошибка = 1;
		КонецЕсли;
		Если ЗакрытьИнтерфейс Тогда
			СредстваМультимедиа.ЗакрытьСканированиеШтрихКодов();
		КонецЕсли;
		ПоискПоКодуНаСервере(Штрихкод);	
	#КонецЕсли
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаЗакрытияИнтерфейса(ДополнительныеПараметры) Экспорт
	//Сообщить("Закрывается интерфейс сканирования");
КонецПроцедуры


&НаСервере
Процедура ПоискПоКодуНаСервере(Штрихкод)
	спрМатериалы = Справочники.Материалы;
	спрПодразделения = Справочники.Подразделения;
	Штрихкод = СокрЛП(Строка(Штрихкод));
	Разделитель = ";";
	СтрокаШтрихкод = СтрЗаменить(Штрихкод,Разделитель,Символы.ПС);
	стр = "*strokescribe.com FREE*";
	НоваяСтрока = Объект.ПереченьМатериалов.Добавить();	
	Для Индекс= 1 По СтрЧислоСтрок(СтрокаШтрихкод) Цикл
		Если Индекс = 1 тогда
			Если СтрЧислоВхождений(СтрокаШтрихкод,стр)>0 Тогда 
				СтрокаШтрихкод = Лев(СтрокаШтрихкод,(СтрДлина(СтрокаШтрихкод)-СтрДлина(стр)));	
			КонецЕсли;
			НоваяСтрока.Материал=спрМатериалы.НайтиПоКоду(СтрПолучитьСтроку(СтрокаШтрихкод,Индекс)); 
			Если НоваяСтрока.Материал = Неопределено Тогда
				Сообщить ("Материал не найден");
			КонецЕсли;
		ИначеЕсли Индекс = 2 Тогда
			Если СтрЧислоВхождений(СтрокаШтрихкод,стр)>0 Тогда 
				СтрокаШтрихкод = Лев(СтрокаШтрихкод,(СтрДлина(СтрокаШтрихкод)-СтрДлина(стр)));	
			КонецЕсли;
			Объект.СтрутктурноеПодразделение = спрПодразделения.НайтиПоКоду(СтрПолучитьСтроку(СтрокаШтрихкод,Индекс));
			Если Объект.СтрутктурноеПодразделение = Неопределено Тогда
				Сообщить("Место установки не найдено");
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Элементы.ОткрытьИнтерфейсСканирования.Видимость=0;
	#Если МобильноеПриложениеКлиент Тогда
		Элементы.ОткрытьИнтерфейсСканирования.Видимость=1;
	#КонецЕсли
КонецПроцедуры



